<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TikTokè·é›¢è¨ˆç®—æ©Ÿï¼ˆæ‰‹å‹•ãƒœã‚¿ãƒ³ç‰ˆï¼‰</title>
    <style>
        :root { --primary: #fe2c55; --bg: #0f0f0f; --card: #1c1c1e; --accent: #25f4ee; }
        body { font-family: sans-serif; background: var(--bg); color: #fff; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { width: 100%; max-width: 480px; }
        
        /* ãƒ¡ã‚¤ãƒ³è·é›¢è¡¨ç¤º */
        .main-card { background: var(--card); border-radius: 24px; padding: 30px; text-align: center; border: 1px solid #333; margin-bottom: 15px; }
        .dist-display { font-size: 4.5rem; font-weight: 900; color: var(--primary); margin: 10px 0; letter-spacing: -2px; }
        .sub-info { color: #888; font-size: 0.9rem; }

        /* å±¥æ­´æ“ä½œãƒœã‚¿ãƒ³ */
        .history-controls { display: flex; gap: 10px; margin-bottom: 20px; }
        .btn-hist { flex: 1; background: #3a3a3c; color: #fff; border: none; padding: 12px; border-radius: 12px; font-weight: bold; cursor: pointer; }
        .btn-hist:disabled { opacity: 0.3; cursor: not-allowed; }

        /* ã‚®ãƒ•ãƒˆãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ */
        .gift-buttons { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .btn-gift { background: var(--accent); color: #000; border: none; padding: 20px 10px; border-radius: 16px; font-weight: bold; font-size: 1rem; cursor: pointer; transition: 0.1s; }
        .btn-gift:active { transform: scale(0.95); opacity: 0.8; }

        /* è¨­å®šã‚¨ãƒªã‚¢ */
        .card { background: var(--card); border-radius: 18px; padding: 20px; margin-bottom: 15px; border: 1px solid #333; }
        input, select { background: #2c2c2e; border: 1px solid #3d3d3f; color: #fff; padding: 12px; border-radius: 10px; width: 100%; box-sizing: border-box; margin-bottom: 10px; }
        .btn-add { background: #fff; color: #000; border: none; padding: 12px; border-radius: 10px; font-weight: bold; width: 100%; cursor: pointer; }
        .gift-item { display: flex; justify-content: space-between; align-items: center; background: #2c2c2e; padding: 10px; border-radius: 10px; margin-top: 8px; font-size: 0.9rem; }
        .btn-del { background: #ff3b30; color: #fff; border: none; padding: 5px 10px; border-radius: 6px; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <div class="main-card">
        <div style="font-size: 0.9rem; color: #888;">ç¾åœ¨ã®åˆè¨ˆè·é›¢</div>
        <div class="dist-display" id="totalDist">0m</div>
        <div class="sub-info">ç´¯è¨ˆ: <span id="totalM">0</span>m</div>
    </div>

    <div class="history-controls">
        <button class="btn-hist" id="btnUndo" onclick="undo()">â—€ 1ã¤æˆ»ã‚‹</button>
        <button class="btn-hist" id="btnRedo" onclick="redo()">1ã¤é€²ã‚€ â–¶</button>
    </div>

    <div class="gift-buttons" id="giftButtonContainer">
        </div>

    <div class="card">
        <strong style="display:block; margin-bottom:12px;">ğŸ ã‚®ãƒ•ãƒˆãƒœã‚¿ãƒ³ã®ç™»éŒ²</strong>
        <div style="display:flex; gap:8px; margin-bottom:10px;">
            <input type="text" id="gName" placeholder="ãƒãƒ©" style="flex:2; margin:0">
            <input type="number" id="gVal" placeholder="10" style="flex:1; margin:0">
            <select id="gUnit" style="flex:1; margin:0"><option value="1">m</option><option value="1000">km</option></select>
        </div>
        <button class="btn-add" onclick="addGiftSetting()">ãƒœã‚¿ãƒ³ã‚’è¿½åŠ ã™ã‚‹</button>
        
        <div id="giftList" style="margin-top:15px;"></div>
    </div>

    <button onclick="hardReset()" style="background:none; border:none; color:#444; text-decoration:underline; width:100%; padding:10px; cursor:pointer;">è·é›¢ã‚’0ã«ãƒªã‚»ãƒƒãƒˆ</button>
</div>

<script>
    // çŠ¶æ…‹ç®¡ç†
    let currentDistance = parseFloat(localStorage.getItem('manual_dist')) || 0;
    let giftSettings = JSON.parse(localStorage.getItem('manual_settings')) || [
        { name: "ãƒãƒ©", val: 10, mult: 1 },
        { name: "æŒ‡ãƒãƒ¼ãƒˆ", val: 50, mult: 1 }
    ];
    let history = JSON.parse(localStorage.getItem('manual_history')) || [currentDistance];
    let historyStep = history.length - 1;

    // ç”»é¢æ›´æ–°
    function updateUI() {
        // è·é›¢è¡¨ç¤º
        const isKm = Math.abs(currentDistance) >= 1000;
        document.getElementById('totalDist').innerText = isKm ? (currentDistance/1000).toFixed(2) + "km" : Math.round(currentDistance) + "m";
        document.getElementById('totalM').innerText = Math.round(currentDistance).toLocaleString();

        // å±¥æ­´ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹
        document.getElementById('btnUndo').disabled = (historyStep <= 0);
        document.getElementById('btnRedo').disabled = (historyStep >= history.length - 1);

        // ã‚®ãƒ•ãƒˆãƒœã‚¿ãƒ³ç”Ÿæˆ
        const btnContainer = document.getElementById('giftButtonContainer');
        btnContainer.innerHTML = "";
        giftSettings.forEach(g => {
            const btn = document.createElement('button');
            btn.className = 'btn-gift';
            const sign = g.val >= 0 ? "+" : "";
            const unit = g.mult === 1000 ? "km" : "m";
            btn.innerText = `${g.name}\n(${sign}${g.val}${unit})`;
            btn.onclick = () => addDistance(g.val * g.mult);
            btnContainer.appendChild(btn);
        });

        // è¨­å®šãƒªã‚¹ãƒˆè¡¨ç¤º
        const list = document.getElementById('giftList');
        list.innerHTML = "";
        giftSettings.forEach((g, i) => {
            list.innerHTML += `<div class="gift-item">
                <span>${g.name} (${g.val}${g.mult==1000?'km':'m'})</span>
                <button class="btn-del" onclick="deleteGift(${i})">å‰Šé™¤</button>
            </div>`;
        });

        // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
        localStorage.setItem('manual_dist', currentDistance);
        localStorage.setItem('manual_settings', JSON.stringify(giftSettings));
        localStorage.setItem('manual_history', JSON.stringify(history));
    }

    // è·é›¢åŠ ç®—
    function addDistance(amount) {
        currentDistance += amount;
        // æ–°ã—ã„æ“ä½œãŒã‚ã£ãŸã‚‰ã€ç¾åœ¨ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚ˆã‚Šå…ˆã®å±¥æ­´ã¯å‰Šé™¤ã—ã¦è¿½åŠ 
        history = history.slice(0, historyStep + 1);
        history.push(currentDistance);
        // å±¥æ­´ãŒé•·ã™ããªã„ã‚ˆã†ã«ï¼ˆç›´è¿‘50ä»¶ï¼‰
        if (history.length > 50) history.shift();
        historyStep = history.length - 1;
        updateUI();
    }

    // æˆ»ã‚‹
    function undo() {
        if (historyStep > 0) {
            historyStep--;
            currentDistance = history[historyStep];
            updateUI();
        }
    }

    // é€²ã‚€
    function redo() {
        if (historyStep < history.length - 1) {
            historyStep++;
            currentDistance = history[historyStep];
            updateUI();
        }
    }

    // è¨­å®šè¿½åŠ 
    function addGiftSetting() {
        const name = document.getElementById('gName').value.trim();
        const val = parseFloat(document.getElementById('gVal').value);
        const mult = parseInt(document.getElementById('gUnit').value);
        if (name && !isNaN(val)) {
            giftSettings.push({ name, val, mult });
            updateUI();
            document.getElementById('gName').value = "";
            document.getElementById('gVal').value = "";
        }
    }

    // å‰Šé™¤
    function deleteGift(i) {
        giftSettings.splice(i, 1);
        updateUI();
    }

    // ãƒªã‚»ãƒƒãƒˆ
    function hardReset() {
        if (confirm("è·é›¢ã‚’0ã«æˆ»ã—ã¾ã™ã‹ï¼Ÿï¼ˆã‚®ãƒ•ãƒˆè¨­å®šã¯æ¶ˆãˆã¾ã›ã‚“ï¼‰")) {
            currentDistance = 0;
            history = [0];
            historyStep = 0;
            updateUI();
        }
    }

    // åˆæœŸåŒ–
    updateUI();
</script>
</body>
</html>
